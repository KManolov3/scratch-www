# In-store apps end-to-end tests

**Table of Contents**

  - [Overview](#overview)
  - [Getting started](#getting-started)
    - [NodeJS](#NodeJS)
    - [Java OpenJDK](#Java-OpenJDK)
    - [Android Studio](#android-studio)
    - [Environment variables ANDROID_HOME and JAVA_HOME](#Environment-variables-ANDROID_HOME-and-JAVA_HOME)
    - [Appium Inspector](#appium-inspector)
  - [Automation tests setup](#automation-tests-setup)
  - [Execution of e2e tests](#execution-of-e2e-tests)
    - [Pre-conditions before running tests](#pre-conditions-before-running-tests)
    - [Execution scripts](#execution-scripts)
  - [Test Reporting](#test-reporting)


## Overview

This part of the project aims to test the UI of all In-store applications by executing end-to-end tests. All of the apps are using Android as a mobile operating system so the e2e tests setup is based on the same platform. WebdriverIO is used as an automation framework which allows running tests based on the WebDriver protocol and Appium server.

## Getting started

### NodeJS

- Download: https://nodejs.org/en/download/
- Install: https://nodejs.org/en/download/package-manager/#nvm

### Java OpenJDK

- Download https://www.oracle.com/java/technologies/downloads/ and follow the installation notes in the Release information section for the downloaded version.

### Android Studio

- Download: https://developer.android.com/studio
- Install: https://developer.android.com/studio/install

After installation is successfully completed open Android studio and create virtual device from which the applications will be launched by the automation tests.

- Create and manage virtual device: https://developer.android.com/studio/run/managing-avds

### Environment variables ANDROID_HOME and JAVA_HOME

Set your environment variables ANDROID_HOME and JAVA_HOME taking into account the specifics of your operation system.

Helpful information:

- JAVA_HOME: https://www.java.com/en/download/help/path.html
- ANDROID_HOME: https://developer.android.com/studio/command-line/variables

### Appium Inspector

GUI of the Appium Inspector allows you to identify the UI elements application under test and easily to define element locators used from e2e tests to interact with the app.

- Navigate to the Appium Inspector GitHub page https://github.com/appium/appium-inspector and follow the installation steps provided in the README.md file

## Automation tests setup

1. Clone the repository: https://bitbucket.org/advanceauto/in-store-mobile-app
2. Run `npm install` inside `<path-to-project>/in-store-apps/e2e-tests` directory
3. Create a `e2e-tests/.env` file by copying `e2e-tests.env.example`
4. E2E tests are using ES modules which require all imports paths to include the file extension. In order to achieve this type of setup VS Code `settings.json` file should include `"typescript.preferences.importModuleSpecifierEnding": "js"`. Configuration steps:

     - Open VS Code and from menu `File > Save Workspace As...` which will open a new dialog to create a file with name `in-store-apps.code-workspace`. Save the file outside of the project's directory.
     - From VS Code menu `File > Close Workspace`.
     - Open again VS Code and from menu `File > Open File...` and choose the `in-store-apps.code-workspace` file from the previous step.
     - Replace the file content with the one below but keep in mind to change the path to project. An easy way to this is before replacing file content to copy the autogenerated path from the original file.

        ```
        {
          "folders": [
            {
              "path": "<absolute-path-to-project-folder>/in-store-apps/app"
            },
            {
              "path": "<absolute-path-to-project-folder>/in-store-apps/mock-server"
            },
            {
              "path": "<absolute-path-to-project-folder>/in-store-apps/e2e-tests",
              "settings": {
                "typescript.preferences.importModuleSpecifierEnding": "js"
              }
            }
          ],
          "settings": {
            "explorer.autoRevealExclude": {
              "**/bower_components": false
            },
            "VSCodeCounter.exclude": ["**/.gitignore", "**/.vscode/**"]
          }
        }
        ```
     - Close the file.
     - Open project from VS Code menu `File > Open Workspace from File...` and choose `in-store-apps.code-workspace`
     - Inside `e2e-tests` create new sub-folder `.vsode` and inside it create a new file `settings.json` with the following content:

          `{ "typescript.preferences.importModuleSpecifierEnding": "js" }`

## Execution of e2e tests

### Pre-conditions before running tests

1. Inside `app` folder run: `npm start` which will start React Native.
2. Inside `mock-server` folder run: `npm start` which will start Apollo Server.
3. Inside `e2e-tests` folder run: `appium` which will start Appium Server.
4. Open Android Studio and start the virtual device.

### Execution scripts

All of the test suites are located in `e2e-tests/specs`. Each application has it's own sub-folder with specific name which should not be changed (e.g. `cycle-count`, `item-lookup`, etc.) because execution scripts relying on exactly this sub-folder name. There are two ways to run e2e tests (in both cases tests should be executed inside `e2e-tests` folder):

  1. Run the tests only for a single application: there are scripts defined in `package.json` file for each app following the naming convention  `e2e:<app-name>`. To execute a script use for example `npm run e2e:cycle-count` which will run all spec files in `cycle-count` directory. If you want to execute only one spec file pass it as an argument to the script - `npm run e2e:cycle-count <file-name>`.

  2. Run the tests for multiple/all applications: again there is a script defined in `package.json` file `e2e:multiple-apps`. Running `npm run e2e:multiple-apps` (without an argument) will first run all tests for the first app, then for the second and so on until the tests for all apps are executed. You can pass list of apps (name of a script as described in point 1.) as an argument to this script (e.g. `npm run e2e:multiple-apps "e2e:cycle-count e2e:item-lookup"`. This will execute only the tests for cycle-count and item-lookup apps).

## Test Reporting

- After running the tests, you will see a test report in the console. Additionally, an HTML report will be generated at:
 
    - if you run the tests only for a single application: `te2e-tests/reports/<app-name>/report.html`.
    - if you run the tests for multiple/all applications: there will be multiple sub-folder with the name of the app inside `reports-from-multiple-apps` and individual `report.html` file in each sub-folder.

- Screenshots of the failed test cases (if any) will be located in `e2e-tests/reports/<app-name>/screenshots/` or `e2e-tests/reports-from-multiple-apps/<app-name>/screenshots/`.


